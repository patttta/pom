<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íì¸ˆì¿ í‚¤</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
  text-align: center;
  padding: 60px;
}

.logo-wrap img {
  max-width: 350px;
  width: 100%;
  cursor: pointer;
}

.title-image img {
  max-width: 260px;
  width: 100%;
  cursor: pointer;
}

.result {
  display: none;
  margin-top: 30px;
}

.image-box {
  position: relative;
  height: 260px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.image-box img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  z-index: 2;
}

/* íŒ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes pop {
  0% { opacity: 0; transform: scale(0.85); }
  100% { opacity: 1; transform: scale(1); }
}
.pop { animation: pop 0.35s ease-out; }

/* ğŸ€ í´ë¡œë²„ íŒ¡ */
.clover {
  position: absolute;
  width: 36px;
  height: 36px;
  pointer-events: none;
  z-index: 5;

  animation: cloverFly 0.9s ease-out forwards;
}

.clover img {
  width: 100%;
  height: 100%;
}


@keyframes cloverFly {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.3);
  }
  30% {
    opacity: 1;
  }
  100% {
    opacity: 0;
    transform:
      translate(-50%, -50%)
      translate(var(--tx), var(--ty))
      scale(1.15);
  }
}

/* ğŸŒ§ ì´ë¯¸ì§€ ë¹„ íš¨ê³¼ */
.rain-img {
  position: absolute;
  top: -40px;
  width: 28px;
  height: 28px;
  pointer-events: none;
  z-index: 6;

  animation: rainDrop 1.1s linear forwards;
}

@keyframes rainDrop {
  0% {
    opacity: 0;
    transform: translateY(0) scale(0.9);
  }
  15% {
    opacity: 1;
  }
  100% {
    opacity: 0;
    transform: translateY(320px) scale(1.05);
  }
}


.info {
  margin: 15px 0;
  font-size: 14px;
  color: #8D7860;
}

.notice {
  margin-top: 15px;
  font-size: 15px;
  white-space: pre-line;
}

.copyright {
  margin-top: 120px;
  font-size: 12px;
  color: #8D7860;
}
</style>
</head>

<body>

<div class="logo-wrap">
  <img src="https://i.imgur.com/rYcxn0Z.png" onclick="location.reload()">
</div>

<div class="info">
  <div id="todayText"></div>
  <div id="countdownText"></div>
</div>

<div class="title-image">
  <img id="drawImage"
       src="https://i.imgur.com/kjTteM1.png"
       onclick="drawFortune()">
</div>


<div class="result" id="resultBox">
  <div class="image-box" id="imageBox">
    <img id="resultImage">
  </div>
</div>

<div class="copyright">Â© Pong Fortune Cookie</div>

<script>
  const TEST_MODE = true;
const CLOSED_IMG = "https://i.imgur.com/kjTteM1.png";
const OPEN_IMG   = "https://i.imgur.com/5W1hMkk.png";

const fortunes = [
  { img:"https://i.imgur.com/mok45tF.png", weight: 40 },
  { img:"https://i.imgur.com/yNAPL6o.png", weight: 40 },
  { img:"https://i.imgur.com/J5NLrN7.png", weight: 40 },
  { img:"https://i.imgur.com/eEiQVM9.png", weight: 40 },

  { img:"https://i.imgur.com/QFMg7Jk.png", weight: 50, clover:true },   // â­ í¬ê·€
  { img:"https://i.imgur.com/I0SVaI0.png", weight: 50, gloom:true }   // ğŸŒ§ í¬ê·€

];

function getToday() {
 const d = new Date();
  return `${d.getFullYear()}ë…„ ${d.getMonth() + 1}ì›” ${d.getDate()}ì¼`;
}

function weightedRandom(list) {
  const total = list.reduce((sum, i) => sum + i.weight, 0);
  let r = Math.random() * total;
  for (const item of list) {
    r -= item.weight;
    if (r < 0) return item;
  }
}

function getTimeUntilMidnight() {
  const now = new Date();
  const midnight = new Date();
  midnight.setHours(24,0,0,0);
  const diff = midnight - now;

  const h = String(Math.floor(diff / 3600000)).padStart(2,"0");
  const m = String(Math.floor(diff / 60000) % 60).padStart(2,"0");
  const s = String(Math.floor(diff / 1000) % 60).padStart(2,"0");

  return `${h}:${m}:${s}`;
}

/* ğŸ€ í´ë¡œë²„ ìƒì„± */
function spawnClovers() {
  const box = document.getElementById("imageBox");

  for (let i = 0; i < 12; i++) {
    const c = document.createElement("img");
    c.src = "https://i.imgur.com/pQEDgnW.png";
    c.className = "clover";

    const angle = Math.random() * Math.PI * 2;
    const radius = 80 + Math.random() * 40;

    const tx = Math.cos(angle) * radius;
    const ty = Math.sin(angle) * radius;

    c.style.left = "50%";
    c.style.top = "50%";
    c.style.setProperty("--tx", `${tx}px`);
    c.style.setProperty("--ty", `${ty}px`);

    box.appendChild(c);

    setTimeout(() => c.remove(), 900);
  }
}



function spawnGloom() {
  const box = document.getElementById("imageBox");

  for (let i = 0; i < 14; i++) {
    const drop = document.createElement("img");

    drop.src = "https://i.imgur.com/KwEIQxE.png"; // â­ í•µì‹¬
    drop.className = "rain-img";

    drop.style.left = Math.random() * 100 + "%";

    box.appendChild(drop);

    setTimeout(() => drop.remove(), 1100);
  }
}


function drawFortune() {
  const today = getToday();
  const lastDate = localStorage.getItem("lastDrawDate");

  if (!TEST_MODE && lastDate === today) {
    alert("ì˜¤ëŠ˜ì˜ ìš´ì„¸ë¥¼ ì´ë¯¸ í™•ì¸í–ˆì–´ìš”.");
    return;
  }

  document.getElementById("drawImage").src = OPEN_IMG;

  const result = weightedRandom(fortunes);

if (!TEST_MODE) {
  localStorage.setItem("lastDrawDate", today);
  localStorage.setItem("lastDrawImg", result.img);
}
  showResult(result);
}

function showResult(result) {
  const box = document.getElementById("resultBox");
  const img = document.getElementById("resultImage");

  box.style.display = "block";
  img.src = result.img;

  img.classList.remove("pop");
  void img.offsetWidth;
  img.classList.add("pop");

  if (result.clover) spawnClovers();
  if (result.gloom) spawnGloom();
}

function updateInfo() {
  document.getElementById("todayText").innerText =
    "ì˜¤ëŠ˜ ë‚ ì§œ Â· " + getToday();

  document.getElementById("countdownText").innerText =
    "ë‹¤ìŒ ì¿ í‚¤ê¹Œì§€ ë‚¨ì€ ì‹œê°„Â· " + getTimeUntilMidnight();
}

window.onload = function() {
  updateInfo();
  setInterval(updateInfo, 1000);

  const today = getToday();
  const savedDate = localStorage.getItem("lastDrawDate");
  const savedImg = localStorage.getItem("lastDrawImg");

  if (!TEST_MODE && savedDate === today && savedImg) {

    document.getElementById("drawImage").src = OPEN_IMG;
    showResult({ img: savedImg });
    document.getElementById("notice").innerText =
      "ì˜¤ëŠ˜ì˜ ìš´ì„¸ë¥¼ ì´ë¯¸ í™•ì¸í–ˆì–´ìš”.\nìì • ì´í›„ ë‹¤ì‹œ ì—´ ìˆ˜ ìˆì–´ìš”!";
  }
};
</script>

</body>
</html>
